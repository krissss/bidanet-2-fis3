<link rel="import" href="../components/head.html?__inline">

<div class="container">
  <div class="panel panel-primary">
    <div class="panel-body">
      <div class="operate-message">
        <form id="form" action="" class="form-horizontal form" role="form">
          <div class="msg">进店未订单</div>
          <div class="form-group">
            <label for="call" class="col-xs-4 control-label left">未订单理由</label>
            <div class="col-xs-12">
              <textarea name="reason" class="form-control" rows="3"></textarea>
            </div>
          </div>
          <div class="operate col-xs-10 col-xs-offset-1">
            <input type="submit" class="btn btn-default btn-block" value="保存返回">
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
  iframe.init();
</script>

<script>
  var uuid = request.getParam('id');

  $('#form').bootstrapValidator({
    // live: 'disabled',
    fields: {
      reason: {
        validators: {
          notEmpty: {
            message: '未订单理由不能为空'
          }
        }
      }
    },
    submitHandler: function(validator, form, submitButton) {
      commitForm();
    }
  });

  // 表单提交
  function commitForm(){
    var params = {};
    // 表单数据
    params['no_order_reason'] = $('textarea[name=reason]').val();
    // 额外数据
    params['uuid'] = uuid;
    params['mstime'] = new Date().getTime();
    params['customer_user_status'] = 10;
    // 调用接口
    api.saveObject('BusCustomer', params, function(data){
      if(data.retMsg == 'OK'){
        api.goBack();
      }else{
        alert(data.retMsg);
      }
    });
  }
</script>

<link rel="import" href="../components/foot.html?__inline">